/** * Project: Scratch Management Dashboard * Version: 2.0 (Refactored for Grouped Menu) * Description: Mengelola statistik, penentuan semester otomatis, dan navigasi grup. */import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';import { supabaseUrl, supabaseKey } from './config.js';const supabase = createClient(supabaseUrl, supabaseKey);// --- 1. SELEKTOR ELEMEN ---const statsElements = {    sekolah: document.getElementById('count-sekolah'),    kelas: document.getElementById('count-kelas'),    siswa: document.getElementById('count-siswa')};const logoutBtn = document.getElementById('btn-logout');const semesterLabelEl = document.getElementById('semester-label');const navCards = document.querySelectorAll('.nav-card');// --- 2. LOGIKA SEMESTER & TAHUN AJARAN ---function updateActiveSemester() {    const now = new Date();    const month = now.getMonth() + 1; // 1-12    const year = now.getFullYear();    let semesterName, academicYear;    // Aturan: Juli-Desember (Sem 1), Januari-Juni (Sem 2)    if (month >= 7 && month <= 12) {        semesterName = "Semester 1";        academicYear = `${year}/${year + 1}`;    } else {        semesterName = "Semester 2";        academicYear = `${year - 1}/${year}`;    }    // Simpan ke localStorage untuk kebutuhan filter di halaman lain    localStorage.setItem("activeAcademicYear", academicYear);    localStorage.setItem("activeSemester", semesterName);    if (semesterLabelEl) {        semesterLabelEl.textContent = `${semesterName} - Tahun Ajaran ${academicYear}`;    }}// --- 3. DATA FETCHING (SUPABASE) ---async function getTableCount(table) {    const { count, error } = await supabase        .from(table)        .select('*', { count: 'exact', head: true });    if (error) {        console.error(`Error fetching count from ${table}:`, error);        return 0;    }    return count ?? 0;}async function refreshStats() {    try {        const [sekolah, kelas, siswa] = await Promise.all([            getTableCount('schools'),            getTableCount('classes'),            getTableCount('students')        ]);        if (statsElements.sekolah) statsElements.sekolah.textContent = sekolah;        if (statsElements.kelas) statsElements.kelas.textContent = kelas;        if (statsElements.siswa) statsElements.siswa.textContent = siswa;    } catch (err) {        console.error('Gagal memuat statistik:', err);    }}// --- 4. NAVIGASI (ROUTING) ---function handleNavigation() {    const routes = {        // Kelompok Manajemen Sekolah (Reguler)        'Absensi Sekolah': 'absensi_sekolah.html',        'Guru & Materi': 'guru_materi.html',        'Registrasi Sekolah': 'registrasi_sekolah2.html',        // Kelompok Manajemen Private        'Absensi Private': 'absensi_private.html',        'Registrasi Private': 'registrasi_private.html',        'Materi Private': 'materi_private.html'    };    navCards.forEach((card) => {        card.addEventListener('click', () => {            const text = card.textContent.trim();            const targetUrl = routes[text];            if (targetUrl) {                window.location.href = targetUrl;            } else {                console.warn(`Rute untuk menu "${text}" belum terdaftar.`);                alert(`Halaman ${text} sedang dalam pengembangan.`);            }        });    });}// --- 5. AUTH & INITIALIZATION ---async function initDashboard() {    // Cek Session    const { data: { session } } = await supabase.auth.getSession();    if (!session) {        window.location.href = 'index.html';        return;    }    updateActiveSemester();    await refreshStats();    handleNavigation();}// Event LogoutlogoutBtn?.addEventListener('click', async () => {    const { error } = await supabase.auth.signOut();    if (!error) {        window.location.href = 'index.html';    }});// Jalankan saat DOM siapdocument.addEventListener('DOMContentLoaded', initDashboard);